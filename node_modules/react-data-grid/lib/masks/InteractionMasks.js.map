{"version":3,"file":"InteractionMasks.js","sourceRoot":"","sources":["../../src/masks/InteractionMasks.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect, useCallback } from 'react';\n\n// Components\nimport CellMask from './CellMask';\nimport DragMask, { DraggedPosition } from './DragMask';\nimport EditorContainer from '../editors/EditorContainer';\nimport EditorPortal from '../editors/EditorPortal';\nimport { legacyCellInput } from '../editors/CellInputHandlers';\n\n// Utils\nimport {\n  isCtrlKeyHeldDown,\n  getSelectedDimensions as getDimensions,\n  getNextSelectedCellPosition,\n  canExitGrid,\n  isSelectedCellEditable\n} from '../utils';\n\n// Types\nimport EventBus from '../EventBus';\nimport { UpdateActions, CellNavigationMode } from '../common/enums';\nimport { CalculatedColumn, Position, Dimension, CommitEvent } from '../common/types';\nimport { DataGridProps } from '../DataGrid';\n\ntype SharedCanvasProps<R, SR> = Pick<DataGridProps<R, never, SR>,\n  | 'rows'\n  | 'onCheckCellIsEditable'\n  | 'onSelectedCellChange'\n> & Pick<Required<DataGridProps<R, never, SR>>,\n  | 'rowHeight'\n  | 'enableCellAutoFocus'\n  | 'enableCellCopyPaste'\n  | 'enableCellDragAndDrop'\n  | 'cellNavigationMode'\n  | 'editorPortalTarget'\n  | 'onRowsUpdate'\n>;\n\ninterface SelectCellState extends Position {\n  status: 'SELECT';\n}\n\ninterface EditCellState extends Position {\n  status: 'EDIT';\n  key: string | null;\n}\n\nexport interface InteractionMasksProps<R, SR> extends SharedCanvasProps<R, SR> {\n  columns: readonly CalculatedColumn<R, SR>[];\n  gridRef: React.RefObject<HTMLDivElement>;\n  totalHeaderHeight: number;\n  scrollLeft: number;\n  scrollTop: number;\n  eventBus: EventBus;\n  scrollToCell: (cell: Position) => void;\n}\n\nexport default function InteractionMasks<R, SR>({\n  columns,\n  rows,\n  rowHeight,\n  eventBus,\n  enableCellAutoFocus,\n  enableCellCopyPaste,\n  enableCellDragAndDrop,\n  editorPortalTarget,\n  cellNavigationMode,\n  gridRef,\n  totalHeaderHeight,\n  scrollLeft,\n  scrollTop,\n  onSelectedCellChange,\n  onCheckCellIsEditable,\n  onRowsUpdate,\n  scrollToCell\n}: InteractionMasksProps<R, SR>) {\n  const [selectedPosition, setSelectedPosition] = useState<SelectCellState | EditCellState>(() => {\n    if (enableCellAutoFocus && document.activeElement === document.body && columns.length > 0 && rows.length > 0) {\n      return { idx: 0, rowIdx: 0, status: 'SELECT' };\n    }\n    return { idx: -1, rowIdx: -1, status: 'SELECT' };\n  });\n  const [copiedPosition, setCopiedPosition] = useState<Position & { value: unknown } | null>(null);\n  const [draggedPosition, setDraggedPosition] = useState<DraggedPosition | null>(null);\n  const selectionMaskRef = useRef<HTMLDivElement>(null);\n\n  // Focus on the selection mask when the selected position is changed or the editor is closed\n  useEffect(() => {\n    if (selectedPosition.rowIdx === -1 || selectedPosition.idx === -1 || selectedPosition.status === 'EDIT') return;\n    selectionMaskRef.current?.focus();\n  }, [selectedPosition]);\n\n  useEffect(() => {\n    return eventBus.subscribe('SELECT_CELL', selectCell);\n  });\n\n  useEffect(() => {\n    if (draggedPosition === null) return;\n    const handleDragEnter = (overRowIdx: number) => {\n      setDraggedPosition({ ...draggedPosition, overRowIdx });\n    };\n    return eventBus.subscribe('DRAG_ENTER', handleDragEnter);\n  }, [draggedPosition, eventBus]);\n\n  const closeEditor = useCallback(() => {\n    setSelectedPosition(({ idx, rowIdx }) => ({ idx, rowIdx, status: 'SELECT' }));\n  }, []);\n\n  // Reset the positions if the current values are no longer valid. This can happen if a column or row is removed\n  if (selectedPosition.idx > columns.length || selectedPosition.rowIdx > rows.length) {\n    setSelectedPosition({ idx: -1, rowIdx: -1, status: 'SELECT' });\n    setCopiedPosition(null);\n    setDraggedPosition(null);\n  }\n\n  function getEditorPosition() {\n    if (gridRef.current === null) return { left: 0, top: 0 };\n    const { left, top } = gridRef.current.getBoundingClientRect();\n    const { scrollTop: docTop, scrollLeft: docLeft } = document.scrollingElement || document.documentElement;\n    const gridLeft = left + docLeft;\n    const gridTop = top + docTop;\n    const column = columns[selectedPosition.idx];\n    return {\n      left: gridLeft + column.left - (column.frozen ? 0 : scrollLeft),\n      top: gridTop + totalHeaderHeight + selectedPosition.rowIdx * rowHeight - scrollTop\n    };\n  }\n\n  function getNextPosition(key: string, mode = cellNavigationMode, shiftKey = false) {\n    const { idx, rowIdx } = selectedPosition;\n    let nextPosition: Position;\n    switch (key) {\n      case 'ArrowUp':\n        nextPosition = { idx, rowIdx: rowIdx - 1 };\n        break;\n      case 'ArrowDown':\n        nextPosition = { idx, rowIdx: rowIdx + 1 };\n        break;\n      case 'ArrowLeft':\n        nextPosition = { idx: idx - 1, rowIdx };\n        break;\n      case 'ArrowRight':\n        nextPosition = { idx: idx + 1, rowIdx };\n        break;\n      case 'Tab':\n        nextPosition = { idx: idx + (shiftKey ? -1 : 1), rowIdx };\n        break;\n      default:\n        nextPosition = { idx, rowIdx };\n        break;\n    }\n\n    return getNextSelectedCellPosition<R, SR>({\n      columns,\n      rowsCount: rows.length,\n      cellNavigationMode: mode,\n      nextPosition\n    });\n  }\n\n  function onKeyDown(event: React.KeyboardEvent<HTMLDivElement>): void {\n    const column = columns[selectedPosition.idx];\n    const row = rows[selectedPosition.rowIdx];\n    const isActivatedByUser = (column.unsafe_onCellInput ?? legacyCellInput)(event, row) === true;\n\n    const { key } = event;\n    if (enableCellCopyPaste && isCtrlKeyHeldDown(event)) {\n      // event.key may be uppercase `C` or `V`\n      const lowerCaseKey = event.key.toLowerCase();\n      if (lowerCaseKey === 'c') return handleCopy();\n      if (lowerCaseKey === 'v') return handlePaste();\n    }\n\n    const canOpenEditor = selectedPosition.status === 'SELECT' && isCellEditable(selectedPosition);\n\n    switch (key) {\n      case 'Enter':\n        if (canOpenEditor) {\n          setSelectedPosition(({ idx, rowIdx }) => ({ idx, rowIdx, status: 'EDIT', key: 'Enter' }));\n        } else if (selectedPosition.status === 'EDIT') {\n          setSelectedPosition(({ idx, rowIdx }) => ({ idx, rowIdx, status: 'SELECT' }));\n        }\n        break;\n      case 'Escape':\n        closeEditor();\n        setCopiedPosition(null);\n        break;\n      case 'Tab':\n        onPressTab(event);\n        break;\n      case 'ArrowUp':\n      case 'ArrowDown':\n      case 'ArrowLeft':\n      case 'ArrowRight':\n        event.preventDefault();\n        selectCell(getNextPosition(key));\n        break;\n      default:\n        if (canOpenEditor && isActivatedByUser) {\n          setSelectedPosition(({ idx, rowIdx }) => ({ idx, rowIdx, status: 'EDIT', key }));\n        }\n        break;\n    }\n  }\n\n  function onPressTab(e: React.KeyboardEvent<HTMLDivElement>): void {\n    // If we are in a position to leave the grid, stop editing but stay in that cell\n    if (canExitGrid(e, { cellNavigationMode, columns, rowsCount: rows.length, selectedPosition })) {\n      if (selectedPosition.status === 'EDIT') {\n        closeEditor();\n        return;\n      }\n\n      // Reset the selected position before exiting\n      setSelectedPosition({ idx: -1, rowIdx: -1, status: 'SELECT' });\n      return;\n    }\n\n    e.preventDefault();\n    const tabCellNavigationMode = cellNavigationMode === CellNavigationMode.NONE\n      ? CellNavigationMode.CHANGE_ROW\n      : cellNavigationMode;\n    const nextPosition = getNextPosition('Tab', tabCellNavigationMode, e.shiftKey);\n    selectCell(nextPosition);\n  }\n\n  function handleCopy(): void {\n    const { idx, rowIdx } = selectedPosition;\n    const value = rows[rowIdx][columns[idx].key as keyof R];\n    setCopiedPosition({ idx, rowIdx, value });\n  }\n\n  function handlePaste(): void {\n    if (copiedPosition === null || !isCellEditable(selectedPosition)) {\n      return;\n    }\n\n    const { rowIdx: toRow } = selectedPosition;\n\n    const cellKey = columns[selectedPosition.idx].key;\n    const { rowIdx: fromRow, idx, value } = copiedPosition;\n    const fromCellKey = columns[idx].key;\n\n    onRowsUpdate({\n      cellKey,\n      fromRow,\n      toRow,\n      updated: { [cellKey]: value } as unknown as never,\n      action: UpdateActions.COPY_PASTE,\n      fromCellKey\n    });\n  }\n\n  function isCellWithinBounds({ idx, rowIdx }: Position): boolean {\n    return rowIdx >= 0 && rowIdx < rows.length && idx >= 0 && idx < columns.length;\n  }\n\n  function isCellEditable(position: Position) {\n    return isCellWithinBounds(position)\n      && isSelectedCellEditable<R, SR>({ columns, rows, selectedPosition: position, onCheckCellIsEditable });\n  }\n\n  function selectCell(position: Position, enableEditor = false): void {\n    if (!isCellWithinBounds(position)) return;\n\n    if (enableEditor && isCellEditable(position)) {\n      setSelectedPosition({ ...position, status: 'EDIT', key: null });\n    } else {\n      setSelectedPosition({ ...position, status: 'SELECT' });\n    }\n    scrollToCell(position);\n    onSelectedCellChange?.({ ...position });\n  }\n\n  function isDragEnabled(): boolean {\n    return enableCellDragAndDrop && isCellEditable(selectedPosition);\n  }\n\n  function handleDragStart(e: React.DragEvent<HTMLDivElement>): void {\n    e.dataTransfer.effectAllowed = 'copy';\n    // Setting data is required to make an element draggable in FF\n    const transferData = JSON.stringify(selectedPosition);\n    try {\n      e.dataTransfer.setData('text/plain', transferData);\n    } catch (ex) {\n      // IE only supports 'text' and 'URL' for the 'type' argument\n      e.dataTransfer.setData('text', transferData);\n    }\n    setDraggedPosition({ ...selectedPosition, overRowIdx: selectedPosition.rowIdx });\n  }\n\n  function handleDragEnd() {\n    if (draggedPosition === null) return;\n\n    const { rowIdx, overRowIdx } = draggedPosition;\n    const column = columns[draggedPosition.idx];\n    const cellKey = column.key;\n    const value = rows[rowIdx][cellKey as keyof R];\n\n    onRowsUpdate({\n      cellKey,\n      fromRow: rowIdx,\n      toRow: overRowIdx,\n      updated: { [cellKey]: value } as unknown as never,\n      action: UpdateActions.CELL_DRAG\n    });\n\n    setDraggedPosition(null);\n  }\n\n  function onDragHandleDoubleClick(): void {\n    const column = columns[selectedPosition.idx];\n    const cellKey = column.key;\n    const value = rows[selectedPosition.rowIdx][cellKey as keyof R];\n\n    onRowsUpdate({\n      cellKey,\n      fromRow: selectedPosition.rowIdx,\n      toRow: rows.length - 1,\n      updated: { [cellKey]: value } as unknown as never,\n      action: UpdateActions.COLUMN_FILL\n    });\n  }\n\n  function onCommit({ cellKey, rowIdx, updated }: CommitEvent): void {\n    onRowsUpdate({\n      cellKey,\n      fromRow: rowIdx,\n      toRow: rowIdx,\n      updated,\n      action: UpdateActions.CELL_UPDATE\n    });\n    closeEditor();\n  }\n\n  function getSelectedDimensions(selectedPosition: Position): Dimension {\n    return getDimensions({ selectedPosition, columns, scrollLeft, rowHeight });\n  }\n\n  return (\n    <div onKeyDown={onKeyDown}>\n      {copiedPosition && isCellWithinBounds(copiedPosition) && (\n        <CellMask\n          className=\"rdg-cell-copied\"\n          {...getSelectedDimensions(copiedPosition)}\n        />\n      )}\n      {draggedPosition && isCellWithinBounds(draggedPosition) && (\n        <DragMask\n          draggedPosition={draggedPosition}\n          getSelectedDimensions={getSelectedDimensions}\n        />\n      )}\n      {selectedPosition.status === 'SELECT' && isCellWithinBounds(selectedPosition) && (\n        <CellMask\n          className=\"rdg-selected\"\n          tabIndex={0}\n          ref={selectionMaskRef}\n          {...getSelectedDimensions(selectedPosition)}\n        >\n          {isDragEnabled() && (\n            <div\n              className=\"drag-handle\"\n              draggable\n              onDragStart={handleDragStart}\n              onDragEnd={handleDragEnd}\n              onDoubleClick={onDragHandleDoubleClick}\n            />\n          )}\n        </CellMask>\n      )}\n      {selectedPosition.status === 'EDIT' && isCellWithinBounds(selectedPosition) && (\n        <EditorPortal target={editorPortalTarget}>\n          <EditorContainer<R, SR>\n            firstEditorKeyPress={selectedPosition.key}\n            onCommit={onCommit}\n            onCommitCancel={closeEditor}\n            rowIdx={selectedPosition.rowIdx}\n            row={rows[selectedPosition.rowIdx]}\n            rowHeight={rowHeight}\n            column={columns[selectedPosition.idx]}\n            scrollLeft={scrollLeft}\n            scrollTop={scrollTop}\n            {...getEditorPosition()}\n          />\n        </EditorPortal>\n      )}\n    </div>\n  );\n}\n"]}